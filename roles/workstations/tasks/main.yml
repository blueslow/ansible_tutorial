- name: install unzip
  package:
    name: unzip

- name: install terraform
  unarchive:
    src: https://releases.hashicorp.com/terraform/0.15.0/terraform_0.15.0_linux_amd64.zip
    dest: /usr/local/bin
    remote_src: yes
    mode: 0755
    owner: root
    group: root
  state: absent
  
- name: install command line apps
  apt:
    pkg:
    - git
    - ansible
    - aria2
    - fdupes
    - parallel
    - tmux
    - python3-pip
    - curl
    - rename
    - cifs-utils
  state: latest

- name: Checkout blueslow's dotfiles
  become_user: klaseh
  ansible.builtin.git:
    repo: https://github.com/blueslow/dotfiles.git
    dest: /home/klaseh/dev/dotfiles
    clone: true
  notify: source_dotfiles

- name: create klaseh .creds directory
  file:
    path: /home/klaseh/.creds
    state: directory
    owner: klaseh
    group: klaseh
    mode: 0700

- name: copy klaseh cred files
  copy:
    src: /home/klaseh/.ssh/creds/
    dest: /home/klaseh/.creds/
    owner: klaseh
    group: klaseh
    mode: 0600

- name: create symlink to /media/klaseh directory in klaseh home
  file:
    src: /media/klaseh
    dest: /home/klaseh/klaseh
    owner: klaseh
    group: klaseh
    state: link

- name: create symlink to /media/shared directory in klaseh home
  file:
    src: /media/shared
    dest: /home/klaseh/shared
    owner: klaseh
    group: klaseh
    state: link

- name: Mount klaseh share
  mount:
    path: /media/klaseh
    src: //192.168.10.1/klaseh
    fstype: cifs
    opts: credentials=/home/klaseh/.creds/condor_klaseh,iocharset=utf8,uid=klaseh,gid=klaseh
    state: mounted
#  notify: mount_all

- name: Mount shared share
  mount:
    path: /media/shared
    src: //192.168.10.1/shared
    fstype: cifs
    opts: credentials=/home/klaseh/.creds/condor_klaseh,iocharset=utf8,uid=klaseh,gid=klaseh
    state: mounted
#  notify: mount_all
