- name: install unzip
  package:
    name:
      - unzip
      - cifs-utils

- name: install command line apps
  apt:
    pkg:
    - git
    - ansible
    - aria2
    - fdupes
    - parallel
    - tmux
    - python3-pip
    - curl
    - rename
    - cifs-utils
    state: latest

- name: install python packages
  pip:
    name:
      - topalias
      - bpytop
      - youtube-dl
    state: latest

- name: Checkout blueslow's dotfiles
  become_user: klaseh
  ansible.builtin.git:
    repo: https://github.com/blueslow/dotfiles.git
    dest: /home/klaseh/dev/dotfiles
    clone: true
  notify: source_dotfiles

- name: create klaseh .creds directory
  file:
    path: /home/klaseh/.creds
    state: directory
    owner: klaseh
    group: klaseh
    mode: 0700

- name: copy klaseh cred files
  copy:
    src: /home/klaseh/.ssh/creds/
    dest: /home/klaseh/.creds/
    owner: klaseh
    group: klaseh
    mode: 0600

- name: Mount klaseh share
  mount:
    path: /media/klaseh
    src: //192.168.10.1/klaseh
    fstype: cifs
    opts: credentials=/home/klaseh/.creds/condor_klaseh,iocharset=utf8,uid=klaseh,gid=klaseh
    state: mounted
#  notify: mount_all

- name: Mount shared share
  mount:
    path: /media/shared
    src: //192.168.10.1/shared
    fstype: cifs
    opts: credentials=/home/klaseh/.creds/condor_klaseh,iocharset=utf8,uid=klaseh,gid=klaseh
    state: mounted
#  notify: mount_all


- name: create symlink to /media/klaseh directory in klaseh home
  file:
    src: /media/klaseh
    dest: /home/klaseh/klaseh
    owner: klaseh
    group: klaseh
    state: link
 #   force: yes

- name: create symlink to /media/shared directory in klaseh home
  file:
    src: /media/shared
    dest: /home/klaseh/shared
    owner: klaseh
    group: klaseh
 #   state: link
    force: yes

